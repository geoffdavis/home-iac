# Example S3 Buckets Configuration
# After running the discovery script, update this file with your actual buckets
# and save as s3-buckets.tf

module "s3_buckets" {
  source = "../../modules/s3-buckets"
  
  buckets = {
    # Example bucket with basic configuration
    my_data_bucket = {
      bucket_name = "my-unique-data-bucket"
      acl         = "private"
      versioning  = true
      
      server_side_encryption = {
        algorithm = "AES256"
      }
      
      public_access_block = {
        block_public_acls       = true
        block_public_policy     = true
        ignore_public_acls      = true
        restrict_public_buckets = true
      }
      
      tags = {
        Purpose = "Data Storage"
        Owner   = "DataTeam"
      }
    }
    
    # Example bucket with lifecycle rules
    my_logs_bucket = {
      bucket_name = "my-unique-logs-bucket"
      
      lifecycle_rules = [
        {
          id                         = "expire-old-logs"
          enabled                    = true
          prefix                     = "logs/"
          expiration_days           = 90
          noncurrent_expiration_days = 30
        }
      ]
      
      server_side_encryption = {
        algorithm = "aws:kms"
        kms_master_key_id = "alias/aws/s3"
      }
    }
    
    # Example bucket with custom policy
    my_public_assets = {
      bucket_name = "my-unique-public-assets"
      
      public_access_block = {
        block_public_acls       = false
        block_public_policy     = false
        ignore_public_acls      = false
        restrict_public_buckets = false
      }
      
      bucket_policy = jsonencode({
        Version = "2012-10-17"
        Statement = [
          {
            Sid       = "PublicReadGetObject"
            Effect    = "Allow"
            Principal = "*"
            Action    = "s3:GetObject"
            Resource  = "arn:aws:s3:::my-unique-public-assets/*"
          }
        ]
      })
    }
  }
  
  common_tags = local.common_tags
}

# Outputs to reference bucket information
output "s3_bucket_ids" {
  description = "Map of bucket names to IDs"
  value       = module.s3_buckets.bucket_ids
}

output "s3_bucket_arns" {
  description = "Map of bucket names to ARNs"
  value       = module.s3_buckets.bucket_arns
}